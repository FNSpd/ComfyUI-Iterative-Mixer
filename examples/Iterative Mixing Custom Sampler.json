{"last_node_id":32,"last_link_id":47,"nodes":[{"id":18,"type":"Reroute","pos":[771,62],"size":[75,26],"flags":{},"order":10,"mode":0,"inputs":[{"name":"","type":"*","link":22}],"outputs":[{"name":"","type":"VAE","links":[23,24,28],"slot_index":0}],"properties":{"showOutputText":false,"horizontal":false}},{"id":19,"type":"Reroute","pos":[1720,63],"size":[75,26],"flags":{},"order":13,"mode":0,"inputs":[{"name":"","type":"*","link":24}],"outputs":[{"name":"","type":"VAE","links":[25,36],"slot_index":0}],"properties":{"showOutputText":false,"horizontal":false}},{"id":23,"type":"Note","pos":[424,1243],"size":{"0":311.47174072265625,"1":84.91732788085938},"flags":{},"order":0,"mode":0,"properties":{"text":""},"widgets_values":["PatchModelAddDownscale is always a good idea if you are upscaling beyond the dimensions for which the model was trained, but don't expect miracles."],"color":"#432","bgcolor":"#653"},{"id":13,"type":"VAEEncode","pos":[1251,420],"size":{"0":210,"1":46},"flags":{},"order":19,"mode":0,"inputs":[{"name":"pixels","type":"IMAGE","link":16},{"name":"vae","type":"VAE","link":28,"slot_index":1}],"outputs":[{"name":"LATENT","type":"LATENT","links":[17,33],"shape":3,"slot_index":0}],"properties":{"Node name for S&R":"VAEEncode"}},{"id":25,"type":"VAEDecode","pos":[1658.5650127734377,1279.3307348046878],"size":{"0":210,"1":46},"flags":{},"order":24,"mode":0,"inputs":[{"name":"samples","type":"LATENT","link":34},{"name":"vae","type":"VAE","link":36,"slot_index":1}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[35],"shape":3,"slot_index":0}],"properties":{"Node name for S&R":"VAEDecode"},"color":"#222","bgcolor":"#000"},{"id":22,"type":"Note","pos":[1299,983],"size":{"0":294.17535400390625,"1":104.47560119628906},"flags":{},"order":1,"mode":0,"properties":{"text":""},"widgets_values":["The scheduler requires the model as an input so it can calculate the correct sigmas. Try a denoise of up to 1.0 here and adjust downward if you feel the de-noising is causing artifacts."],"color":"#432","bgcolor":"#653"},{"id":8,"type":"VAEDecode","pos":[1209,188],"size":{"0":210,"1":46},"flags":{},"order":16,"mode":0,"inputs":[{"name":"samples","type":"LATENT","link":7},{"name":"vae","type":"VAE","link":23}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[15,37],"slot_index":0}],"properties":{"Node name for S&R":"VAEDecode"}},{"id":27,"type":"Note","pos":[1659,1437],"size":{"0":210,"1":260.21343994140625},"flags":{},"order":2,"mode":0,"properties":{"text":""},"widgets_values":["To keep us honest, here is a simple 20% de-noising upscale workflow using a regular KSampler. The thing to notice here is whether the iterative mixing sampler above helps to keep the final image more consistent with the low resolution image we started with.\n\nWith this low quality upscale, you should see some pretty bad artifacts from a simple KSampler refinement step."],"color":"#432","bgcolor":"#653"},{"id":29,"type":"FreeU_V2","pos":[86,994],"size":{"0":315,"1":130},"flags":{},"order":7,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":42,"slot_index":0}],"outputs":[{"name":"MODEL","type":"MODEL","links":[41,43],"shape":3,"slot_index":0}],"properties":{"Node name for S&R":"FreeU_V2"},"widgets_values":[1.3,1.4,0.9,0.2]},{"id":20,"type":"PatchModelAddDownscale","pos":[422,985],"size":{"0":352.79998779296875,"1":202},"flags":{},"order":11,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":41}],"outputs":[{"name":"MODEL","type":"MODEL","links":[30,31,38,44],"shape":3,"slot_index":0}],"properties":{"Node name for S&R":"PatchModelAddDownscale"},"widgets_values":[3,2,0,0.35,true,"bicubic","bicubic"]},{"id":21,"type":"Note","pos":[1296,601],"size":{"0":302.7120666503906,"1":338.9406433105469},"flags":{},"order":3,"mode":0,"properties":{"text":""},"widgets_values":["The iterative mixing sampler is like a regular sampler, except that before de-noising the latent, it generates a noised sequence from the latent and then blends in a part of the noised latent during de-noising. If you pass in a roughly upscaled latent, this iterative mixing causes the diffusion model to more closely follow the structure of the upscaled image during de-noising than it would if it did not have the guidance of the noised latent sequence.\n\nThere are many settings to play with and different samplers to choose from. The defaults are conservative. Try the euler_perlin sampler for crazy (and often broken) results. The euler_perlin sampler calls the model a second time each step, applying a perlin noise mask to de-noise just a portion of the latent each step. If your image seems a bit fuzzy, try adding perlin noise cautiously starting with perlin_strength at 0.2 and using perlin_mode \"masks\". The other perlin_mode options are experimental and may produce junk.\n\nAlso, try \"slerp\" and \"norm_only\" blending methods..."],"color":"#432","bgcolor":"#653"},{"id":10,"type":"SamplerCustom","pos":[1943,607],"size":{"0":355.20001220703125,"1":442},"flags":{},"order":21,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":44,"slot_index":0},{"name":"positive","type":"CONDITIONING","link":13,"slot_index":1},{"name":"negative","type":"CONDITIONING","link":14,"slot_index":2},{"name":"sampler","type":"SAMPLER","link":18,"slot_index":3},{"name":"sigmas","type":"SIGMAS","link":19,"slot_index":4},{"name":"latent_image","type":"LATENT","link":17,"slot_index":5}],"outputs":[{"name":"output","type":"LATENT","links":[20],"shape":3,"slot_index":0},{"name":"denoised_output","type":"LATENT","links":null,"shape":3}],"properties":{"Node name for S&R":"SamplerCustom"},"widgets_values":[false,179912368649578,"fixed",8],"color":"#323","bgcolor":"#535"},{"id":4,"type":"CheckpointLoaderSimple","pos":[-35,421],"size":{"0":315,"1":98},"flags":{},"order":4,"mode":0,"outputs":[{"name":"MODEL","type":"MODEL","links":[42],"slot_index":0},{"name":"CLIP","type":"CLIP","links":[3,5],"slot_index":1},{"name":"VAE","type":"VAE","links":[22],"slot_index":2}],"properties":{"Node name for S&R":"CheckpointLoaderSimple"},"widgets_values":["epic-realism.safetensors"]},{"id":24,"type":"KSampler","pos":[1298.5650127734377,1279.3307348046878],"size":{"0":315,"1":473.99993896484375},"flags":{},"order":22,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":38,"slot_index":0},{"name":"positive","type":"CONDITIONING","link":39,"slot_index":1},{"name":"negative","type":"CONDITIONING","link":40,"slot_index":2},{"name":"latent_image","type":"LATENT","link":33}],"outputs":[{"name":"LATENT","type":"LATENT","links":[34],"shape":3,"slot_index":0}],"properties":{"Node name for S&R":"KSampler"},"widgets_values":[0,"fixed",40,8,"euler","normal",0.5],"color":"#222","bgcolor":"#000"},{"id":6,"type":"CLIPTextEncode","pos":[415,186],"size":{"0":422.84503173828125,"1":164.31304931640625},"flags":{},"order":8,"mode":0,"inputs":[{"name":"clip","type":"CLIP","link":3}],"outputs":[{"name":"CONDITIONING","type":"CONDITIONING","links":[4,13,39],"slot_index":0}],"properties":{"Node name for S&R":"CLIPTextEncode"},"widgets_values":["elderly man, rough face, grey hair, english pub, 1950s, bokeh, fedora\n"],"color":"#232","bgcolor":"#353"},{"id":5,"type":"EmptyLatentImage","pos":[418,615],"size":{"0":315,"1":106},"flags":{},"order":5,"mode":0,"outputs":[{"name":"LATENT","type":"LATENT","links":[2],"slot_index":0}],"properties":{"Node name for S&R":"EmptyLatentImage"},"widgets_values":[512,768,1]},{"id":7,"type":"CLIPTextEncode","pos":[413,389],"size":{"0":425.27801513671875,"1":180.6060791015625},"flags":{},"order":9,"mode":0,"inputs":[{"name":"clip","type":"CLIP","link":5}],"outputs":[{"name":"CONDITIONING","type":"CONDITIONING","links":[6,14,40],"slot_index":0}],"properties":{"Node name for S&R":"CLIPTextEncode"},"widgets_values":["text, watermark, nude, child"],"color":"#322","bgcolor":"#533"},{"id":28,"type":"PreviewImage","pos":[1448,-35],"size":{"0":168,"1":269.6400146484375},"flags":{},"order":18,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":37}],"title":"Low Resolution Image","properties":{"Node name for S&R":"PreviewImage"}},{"id":12,"type":"ImageScaleBy","pos":[1246,297],"size":{"0":315,"1":82},"flags":{},"order":17,"mode":0,"inputs":[{"name":"image","type":"IMAGE","link":15}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[16,45],"shape":3,"slot_index":0}],"properties":{"Node name for S&R":"ImageScaleBy"},"widgets_values":["lanczos",2]},{"id":30,"type":"PreviewImage","pos":[2382,-151],"size":{"0":382.24578857421875,"1":607.4000244140625},"flags":{},"order":20,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":45}],"title":"Rough Upscale","properties":{"Node name for S&R":"PreviewImage"}},{"id":16,"type":"VAEDecode","pos":[2214,556],"size":{"0":210,"1":46},"flags":{"collapsed":true},"order":23,"mode":0,"inputs":[{"name":"samples","type":"LATENT","link":20},{"name":"vae","type":"VAE","link":25}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[21],"shape":3,"slot_index":0}],"properties":{"Node name for S&R":"VAEDecode"}},{"id":3,"type":"KSampler","pos":[863,186],"size":{"0":315,"1":474},"flags":{},"order":12,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":43},{"name":"positive","type":"CONDITIONING","link":4},{"name":"negative","type":"CONDITIONING","link":6},{"name":"latent_image","type":"LATENT","link":2}],"outputs":[{"name":"LATENT","type":"LATENT","links":[7],"slot_index":0}],"properties":{"Node name for S&R":"KSampler"},"widgets_values":[982480117112842,"fixed",30,8,"euler","normal",1]},{"id":26,"type":"PreviewImage","pos":[2373,1284],"size":{"0":422.44927978515625,"1":622.3859252929688},"flags":{},"order":26,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":35}],"properties":{"Node name for S&R":"PreviewImage"},"color":"#222","bgcolor":"#000"},{"id":15,"type":"IterativeMixingScheduler","pos":[1610.4209966406254,989.1116335742188],"size":{"0":315,"1":106},"flags":{},"order":15,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":31,"slot_index":0}],"outputs":[{"name":"SIGMAS","type":"SIGMAS","links":[19],"shape":3}],"properties":{"Node name for S&R":"IterativeMixingScheduler"},"widgets_values":["normal",40,1],"color":"#323","bgcolor":"#535"},{"id":17,"type":"PreviewImage","pos":[2372,549],"size":{"0":404.7719421386719,"1":629.3260498046875},"flags":{},"order":25,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":21}],"title":"Iterative Mixing Output","properties":{"Node name for S&R":"PreviewImage"},"color":"#323","bgcolor":"#535"},{"id":14,"type":"IterativeMixingSampler","pos":[1613.4209966406254,597.1116335742188],"size":{"0":315,"1":346},"flags":{},"order":14,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":30,"slot_index":0},{"name":"perlin_strength","type":"FLOAT","link":47,"widget":{"name":"perlin_strength"},"slot_index":1}],"outputs":[{"name":"SAMPLER","type":"SAMPLER","links":[18],"shape":3}],"properties":{"Node name for S&R":"IterativeMixingSampler"},"widgets_values":["euler_perlin",1,"cosine","addition",false,0,1,1,0,1,"masks",0.2,10],"color":"#323","bgcolor":"#535"},{"id":32,"type":"FloatRange //Inspire","pos":[916,849],"size":{"0":315,"1":154},"flags":{},"order":6,"mode":0,"outputs":[{"name":"FLOAT","type":"FLOAT","links":[47],"shape":6}],"properties":{"Node name for S&R":"FloatRange //Inspire"},"widgets_values":[0.1,1,0.1,100,true]}],"links":[[2,5,0,3,3,"LATENT"],[3,4,1,6,0,"CLIP"],[4,6,0,3,1,"CONDITIONING"],[5,4,1,7,0,"CLIP"],[6,7,0,3,2,"CONDITIONING"],[7,3,0,8,0,"LATENT"],[13,6,0,10,1,"CONDITIONING"],[14,7,0,10,2,"CONDITIONING"],[15,8,0,12,0,"IMAGE"],[16,12,0,13,0,"IMAGE"],[17,13,0,10,5,"LATENT"],[18,14,0,10,3,"SAMPLER"],[19,15,0,10,4,"SIGMAS"],[20,10,0,16,0,"LATENT"],[21,16,0,17,0,"IMAGE"],[22,4,2,18,0,"*"],[23,18,0,8,1,"VAE"],[24,18,0,19,0,"*"],[25,19,0,16,1,"VAE"],[28,18,0,13,1,"VAE"],[30,20,0,14,0,"MODEL"],[31,20,0,15,0,"MODEL"],[33,13,0,24,3,"LATENT"],[34,24,0,25,0,"LATENT"],[35,25,0,26,0,"IMAGE"],[36,19,0,25,1,"VAE"],[37,8,0,28,0,"IMAGE"],[38,20,0,24,0,"MODEL"],[39,6,0,24,1,"CONDITIONING"],[40,7,0,24,2,"CONDITIONING"],[41,29,0,20,0,"MODEL"],[42,4,0,29,0,"MODEL"],[43,29,0,3,0,"MODEL"],[44,20,0,10,0,"MODEL"],[45,12,0,30,0,"IMAGE"],[47,32,0,14,1,"FLOAT"]],"groups":[{"title":"Recommended","bounding":[67,905,680,433],"color":"#8A8","font_size":24,"locked":false},{"title":"Iterative Mixing Nodes","bounding":[1286,475,1502,710],"color":"#a1309b","font_size":24,"locked":false},{"title":"For Comparison - A simple KSampler refinement upscale workflow","bounding":[1289,1205,1526,713],"color":"#3f789e","font_size":24,"locked":false}],"config":{},"extra":{},"version":0.4}